#!/bin/sh
# Configuration requires that we rebuild the top level Makefiles
# in this directory and lower directories

SYSTEM=`uname -s`
UNAME=`uname -a`
PROFILE=
PREFIX="\/usr\/local"
USER=root
OPENGL="opengl"
ECHO=echo

case $SYSTEM in
  IRIX*)
   system=sgi;
   GROUP=sys;
   ARCH=`uname -r`;;
  Linux)
   system=linux;
   GROUP=root;
   PREFIX="\/libwgs";
   ARCH=`uname -m`;;
  SunOS)
   system=sun;
   GROUP=bin;
   ARCH=`uname -r`;;
  Darwin)
   system=macosx;
   GROUP=admin;
   ARCH=`uname -p`;
   ECHO=/bin/echo;;
  *)
   system=unknown;;
esac;

DEBUG="debug"
STATIC=""
DLL="staticlib"


for x in $@
do
  case $x in
  --nodebug)
    DEBUG="";;
  --shared) 
    DLL="dll";;
  --static)
    STATIC="-static";;
  --gprof)
    PROFILE="-pg";;
  --help|-h)
    $ECHO "Usage: configure [options]";
    $ECHO "    --nodebug     disable support for debugging";
    $ECHO "    --shared      build libraries as dynamically linkable shared objects";
    $ECHO "    --static      build a staticly linked version."; 
    $ECHO "    --help|-h     display this help message";
    exit;;
  *)
    $ECHO "unknown option $x";
    exit;;
  esac
done

$ECHO "Removing old Makefiles"
rm -f `find . -name Makefile`

#
# We need to set the appropriate architecture
#
for x in `find . -name \*.pro.in` 
do
  dir=`dirname $x`
  y=`basename $x .in`
  $ECHO -n "Generating project file $dir/$y ... "
  sed "s/@PREFIX@/$PREFIX/g;s/@GROUP@/$GROUP/g;s/@USER@/$USER/g;s/@PROFILE@/$PROFILE/g;s/@SYSTEM@/$SYSTEM/g;s/@ARCH@/$ARCH/g;s/@DLL@/$DLL/g;s/@STATIC@/$STATIC/;s/@DEBUG@/$DEBUG/;s/@system@/$system/g" $x > $dir/$y
  $ECHO "Done."
done

$ECHO -n "Creating make files..."
qmake -r
$ECHO "Done."

